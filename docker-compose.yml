version: "3.8"

services:
  agent-runner:
    build: .
    container_name: shll-agent-runner
    restart: unless-stopped
    environment:
      - RPC_URL=${RPC_URL}
      - CHAIN_ID=${CHAIN_ID:-97}
      - OPERATOR_PK=${OPERATOR_PK}
      - AGENT_NFA_ADDRESS=${AGENT_NFA_ADDRESS}
      - POLICY_GUARD_ADDRESS=${POLICY_GUARD_ADDRESS}
      - TOKEN_ID=${TOKEN_ID}
      - POLL_INTERVAL_MS=${POLL_INTERVAL_MS:-30000}
      - MAX_RETRIES=${MAX_RETRIES:-3}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - AUTO_ACTION_ENABLED=${AUTO_ACTION_ENABLED:-false}
      - AUTO_ACTION_TARGET=${AUTO_ACTION_TARGET:-0x0000000000000000000000000000000000000000}
      - AUTO_ACTION_DATA=${AUTO_ACTION_DATA:-0x}
      - AUTO_ACTION_VALUE=${AUTO_ACTION_VALUE:-0}
      - MIN_ACTION_INTERVAL_MS=${MIN_ACTION_INTERVAL_MS:-300000}
      - REQUIRE_POSITIVE_BALANCE=${REQUIRE_POSITIVE_BALANCE:-true}
      - MARKET_SIGNAL_SYNC_ENABLED=${MARKET_SIGNAL_SYNC_ENABLED:-false}
      - MARKET_SIGNAL_SOURCE_URL=${MARKET_SIGNAL_SOURCE_URL:-}
      - MARKET_SIGNAL_SOURCE_API_KEY=${MARKET_SIGNAL_SOURCE_API_KEY:-}
      - MARKET_SIGNAL_SOURCE_AUTH_HEADER=${MARKET_SIGNAL_SOURCE_AUTH_HEADER:-x-api-key}
      - MARKET_SIGNAL_SOURCE_NAME=${MARKET_SIGNAL_SOURCE_NAME:-source-sync}
      - MARKET_SIGNAL_SYNC_INTERVAL_MS=${MARKET_SIGNAL_SYNC_INTERVAL_MS:-15000}
      - MARKET_SIGNAL_SOURCE_TIMEOUT_MS=${MARKET_SIGNAL_SOURCE_TIMEOUT_MS:-8000}
      - API_HOST=${API_HOST:-0.0.0.0}
      - API_PORT=${API_PORT:-8787}
      - API_KEY=${API_KEY:-}
      - DATABASE_URL=${DATABASE_URL:-}
      - PGHOST=${PGHOST:-postgres}
      - PGPORT=${PGPORT:-5432}
      - PGUSER=${PGUSER:-postgres}
      - PGPASSWORD=${PGPASSWORD:-postgres}
      - PGDATABASE=${PGDATABASE:-shll_runner}
      - PG_SSL=${PG_SSL:-false}
      - PG_POOL_MAX=${PG_POOL_MAX:-10}
      - MAX_RUN_RECORDS=${MAX_RUN_RECORDS:-1000}
      - STATUS_RUNS_LIMIT=${STATUS_RUNS_LIMIT:-20}
    ports:
      - "${API_PORT:-8787}:${API_PORT:-8787}"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
